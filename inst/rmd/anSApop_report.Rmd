---
output:
  word_document:
    reference_docx: anGBtemplate.docx
params:
  SApopdat: ''
  AOInm: ''
  pcfilter: ''
  fortypgrpcd: ''
  title.ref: ''
  
---


```{r Data_Inputs, echo=FALSE, warning=FALSE, message=FALSE}
 
library(FIESTA)
library(RColorBrewer)

SApopdat <- params$SApopdat
AOInm <- params$AOInm
pcfilter <- params$pcfilter
fortypgrpcd <- params$fortypgrpcd
title.ref <- params$title.ref

# AOInm <- "ecoM332"
# load("E:/workspace/FIESTA/FIESTA_SA/testfolder4/M332/SApopdat.rda")
# pcfilter <- NULL
# title.ref <- NULL
# fortypgrpcd <- 200


if (is.null(title.ref)) {
  title.ref <- AOInm
}


## Get states in GBpopdat or that pcfilter
states <- SApopdat$states
invyrs <- unique(unlist(SApopdat$invyrs))

if (!is.null(pcfilter) && 'STATECD' %in% names(SApopdat$pltcondx)) {
  pltcondf <- datFilter(SApopdat$pltcondx, xfilter=pcfilter)$xf
  states <- FIESTA::pcheck.states(unique(pltcondf$STATECD))
  invyrs <- unique(pltcondf$INVYR)
}

if (is.null(pcfilter)) {
  title.statesx=title.states <- NULL
  title.filter <- NULL
} else {
  title.statesx <- paste(states, collapse=" and ")
  title.states <- paste0(", ", paste(states, collapse=" and "))
  title.filter <- AOInm
}
invyrs2 <- paste0(min(invyrs), "-", max(invyrs))


```


---
title: "Forest Resource Report:  \n`r AOInm``r title.states`,  \n`r invyrs2`"
---


-----  

&nbsp;  

Rocky Mountain Research Station, Forest Inventory and Analysis  | `r format(Sys.time(), "%B %Y")`

&nbsp;  

```{r smallbnd, echo=FALSE, warning=FALSE, message=FALSE, fig.width=7.5}

smallbnd <- SApopdat$smallbnd
smallbnd.unique <- SApopdat$smallbnd.unique
plot(st_geometry(smallbnd), border="black", main="")

```
Figure 1. Small area of interest, `r AOInm``r title.states`, `r invyrs2`.

&nbsp;  


----- 


# Summary

&nbsp;  

```{r Summary_Info, echo=FALSE, include=FALSE}
 
dunitlut <- SApopdat$dunitlut
dunitarea <- SApopdat$dunitarea
areavar <- SApopdat$areavar
dominfo <- merge(dunitlut[, c("DOMAIN", "n.total")], dunitarea, by="DOMAIN")
nbrdoms <- nrow(dominfo)
totarea <- sum(dunitarea[[areavar]])

#knitr::kable(dominfo, "simple", align=c("lrr"),
#              digits=c(0,0,0), format.args=list(big.mark = ","))


intro_text1 <- paste0("The total area of ", AOInm, " is ", format(round(totarea), big.mark=","), 
        " acres with ", nbrdoms, " unique small areas. The area intersects ", length(states), 
        " states (", toString(states), ").") 
                      

intro_text2 <-
paste0("Estimates are calculated using the Forest Inventory ESTimation and Analysis (FIESTA) R package (Frescino et al. 2015) and are based on small area estimators from the JoSAE package. Data for this report were extracted from the Forest Inventory and Analysis (FIA) database for years ", invyrs2, " (Burrill et al. 2018). All percent sampling errors are reported at 68% confidence level.")



```


`r intro_text1`

&nbsp;  

`r intro_text2`

&nbsp;   

\newpage

&nbsp;  

-----  


# EST1 - Area of forest land by small area domain.


-----  


Table 1. Area of forest land by small area domain, `r AOInm``r title.states`, `r invyrs2`.

&nbsp;    

```{r est1, echo=FALSE, warning=FALSE, message=FALSE}

SAareadat1 <- modSAest(SApopdat=SApopdat, SApackage="JoSAE", 
	SAmethod="area", esttype="AREA", landarea="FOREST", 
 	smallbnd.att=NULL, savedata=FALSE, rawdata=TRUE,
	returntitle=TRUE, multest=FALSE, title.ref=AOInm, save4testing=TRUE)
est1 <- SAareadat1$est
raw1 <- SAareadat1$raw
titlelst1 <- SAareadat1$titlelst

knitr::kable(est1, "simple", align=c("lrr"), digits=c(0,0,2),
             format.args=list(big.mark = ","))

```  

&nbsp;    


-----  

\newpage

-----  


&nbsp;    

```{r est1_map, echo=FALSE, warning=FALSE, message=FALSE, fig.width=7.5}

#anMOD_barplot(SAareadat, barplot.nplt=TRUE)

## Merge estimate to smallbnd
smallbnd1 <- merge(smallbnd, est1, by.x=smallbnd.unique, by.y="DOMAIN")

pal <- palette(brewer.pal(n=7, name = "Greens"))
plot(smallbnd1["Estimate"], key.pos=1, axes=TRUE, key.width=lcm(1.3), 
	graticule=TRUE, key.length=1.0, breaks="equal", nbreaks=7, 
	pal=palette(brewer.pal(n=7, name="Greens")),
	border="black", lwd=.5, main="")


```
Figure 1. Area of forest land by small area domain, `r AOInm``r title.states`, `r invyrs2`.


\newpage    

&nbsp;  


-----  


# EST2 - Net cubic-foot volume of live trees on forest land by small area domain.


-----  


Table 2. Net cubic-foot volume of live trees on forest land by small area domain, `r AOInm``r title.states`, `r invyrs2`.

&nbsp;    

```{r est2, echo=FALSE, warning=FALSE, message=FALSE}

SAareadat2 <- modSAest(SApopdat=SApopdat, SApackage="JoSAE", 
	SAmethod="area", esttype="TREE", landarea="FOREST", 
	estvar="VOLCFNET", estvar.filter="STATUSCD == 1", 
 	smallbnd.att=NULL, savedata=FALSE, rawdata=TRUE,
	returntitle=TRUE, multest=FALSE, title.ref=AOInm)
est2 <- SAareadat2$est
raw2 <- SAareadat2$raw
titlelst2 <- SAareadat2$titlelst

knitr::kable(est2, "simple", align=c("lrr"), digits=c(0,0,2),
             format.args=list(big.mark = ","))

```  

&nbsp;    


-----  

```{r est2_map, echo=FALSE, warning=FALSE, message=FALSE, fig.width=7.5}

#anMOD_barplot(SAareadat, barplot.nplt=TRUE)

## Merge estimate to smallbnd
smallbnd2 <- merge(smallbnd, est2, by.x=smallbnd.unique, by.y="DOMAIN")

pal <- palette(brewer.pal(n=7, name = "Blues"))
plot(smallbnd2["Estimate"], key.pos=1, axes=TRUE, key.width=lcm(1.3), 
	graticule=TRUE, key.length=1.0, breaks="equal", nbreaks=7, 
	pal=palette(brewer.pal(n=7, name="Blues")),
	border="black", lwd=.5, main="")


```
Figure 2. Net cubic-foot volume of live trees on forest land by small area domain, `r AOInm``r title.states`, `r invyrs2`.


\newpage 


-----  


# EST3 - Square-feet basal area of live trees on forest land by small area domain.


-----  


Table 3. Square-feet basal area of live trees on forest land by small area domain, `r AOInm``r title.states`, `r invyrs2`.

&nbsp;    

```{r est3, echo=FALSE, warning=FALSE, message=FALSE}

SAareadat3 <- modSAest(SApopdat=SApopdat, SApackage="JoSAE", 
	SAmethod="area", esttype="TREE", landarea="FOREST", 
	estvar="BA", estvar.filter="STATUSCD == 1", 
 	smallbnd.att=NULL, savedata=FALSE, rawdata=TRUE,
	returntitle=TRUE, multest=FALSE, title.ref=AOInm)
est3 <- SAareadat3$est
raw3 <- SAareadat3$raw
titlelst3 <- SAareadat3$titlelst

knitr::kable(est3, "simple", align=c("lrr"), digits=c(0,0,2),
             format.args=list(big.mark = ","))

```  


&nbsp;    

```{r est3_map, echo=FALSE, warning=FALSE, message=FALSE, fig.width=7.5}

#anMOD_barplot(SAareadat, barplot.nplt=TRUE)

## Merge estimate to smallbnd
smallbnd3 <- merge(smallbnd, est3, by.x=smallbnd.unique, by.y="DOMAIN")

pal <- palette(brewer.pal(n=7, name = "Oranges"))
plot(smallbnd3["Estimate"], key.pos=1, axes=TRUE, key.width=lcm(1.3), 
	graticule=TRUE, key.length=1.0, breaks="equal", nbreaks=7, 
	pal=palette(brewer.pal(n=7, name="Oranges")),
	border="black", lwd=.5, main="")


```
Figure 3. Square-feet basal area of live trees on forest land by small area domain, `r AOInm``r title.states`, `r invyrs2`.


\newpage    

&nbsp; 


# References

&nbsp;  

Breidenbach, Johannes 2018. JoSAE: Unit-Level and Area-Level Small Area Estimation. R package version 0.3.0. https://CRAN.R-project.org/package=JoSAE.
  
&nbsp;

Burrill, E.A., Wilson, A.M., Turner, J.A., Pugh, S.A., Menlove, J., Christiansen, G., Conkling, B.L., Winnie, D., 2018. Forest Inventory and Analysis Database [WWW Document]. St Paul MN US Dep. Agric. For. Serv. North. Res. Stn. URL http://apps.fs.fed.us/fiadb-downloads/datamart.html (accessed 3.6.21).

&nbsp; 

Frescino, Tracey S.; Patterson, Paul L.; Moisen, Gretchen G.; Toney, Chris; Freeman, Elizabeth A. 2018. FIESTA: A Forest Inventory Estimation and Analysis R Package. USDA Forest Service, Rocky Mountain Research Station, 507 25th street, Ogden, UT, USA.

&nbsp; 

Frescino, Tracey S.; Patterson, Paul L.; Moisen, Gretchen G.; Freeman, Elizabeth A. 2015. FIESTA—An R estimation tool for FIA analysts. In: Stanton, Sharon M.; Christensen, Glenn A., comps. 2015. Pushing boundaries: new directions in inventory techniques and applications: Forest Inventory and Analysis (FIA) symposium 2015. 2015 December 8–10; Portland, Oregon. Gen. Tech. Rep. PNW-GTR-931. Portland, OR: U.S. Department of Agriculture, Forest Service, Pacific Northwest Research Station. p. 72.

