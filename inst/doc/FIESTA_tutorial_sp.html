<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>FIESTA - Spatial Tools</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>





<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">FIESTA - Spatial Tools</h1>



<div id="fiesta-overview" class="section level2">
<h2>FIESTA Overview</h2>
<p>The R package, FIESTA (Forest Inventory ESTimation and Analysis) is a research estimation tool for analysts that work with sample-based inventory data from the U.S. Department of Agriculture, Forest Service, Forest Inventory and Analysis (FIA) Program to accommodate: unique population boundaries, different evaluation time periods, customized stratification schemes, non-standard variance equations, integration of multi-scale remotely-sensed data and other ancillary information, and interaction with other modeling and estimation tools from CRAN R’s library of packages. FIESTA contains a collection of functions that can access FIA databases, summarize and compile plot and spatial data, and generate estimates with associated sampling errors.</p>
<p>Functions are organized by type or objective and are named with a corresponding prefix:</p>
<p><strong>Core Functions</strong></p>
<ul>
<li>Database tools (DB) - functions for querying and extracting data from FIA’s national database.</li>
<li>Data tools (dat) - functions for summarizing and exploring FIA data.</li>
<li>Spatial tools (sp) - functions for manipulating and summarizing spatial data.</li>
</ul>
<p><strong>Estimation Modules</strong></p>
<ul>
<li>Green-Book (GB) - functions for FIA’s standard ‘Green-Book’ estimators.</li>
<li>Photo-Based (PB) - functions for supplementary photo-based estimators.</li>
<li>Small Area (SA) - functions for integration with available small area estimators (SAE).</li>
<li>Model-Assisted (MA) - functions for integration with available Model-Assisted estimators.</li>
</ul>
<p><strong>Analysis Tools</strong></p>
<ul>
<li>Analysis tools (an) - wrapper functions for stream-lining estimation processes.</li>
</ul>
<div id="overview-of-fiesta-spatial-sp-tools" class="section level3">
<h3>Overview of FIESTA spatial (sp) tools</h3>
<p>FIESTA’s spatial tools allow for summarizing and manipulating spatial data for use in FIESTA’s estimation modules.</p>
<table>
<colgroup>
<col width="18%"></col>
<col width="81%"></col>
</colgroup>
<thead>
<tr class="header">
<th>FUNCTION</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#spImportSpatial">spImportSpatial()</a></td>
<td>Imports a spatial layer to a sf object.</td>
</tr>
<tr class="even">
<td><a href="#spExportSpatial">spExportSpatial()</a></td>
<td>Exports a sf object to a spatial layer.</td>
</tr>
<tr class="odd">
<td><a href="#spMakeSpatialPoints">spMakeSpatialPoints()</a></td>
<td>Generates an S4 SpatialPoints object from X/Y coordinates.</td>
</tr>
<tr class="even">
<td><a href="#spReprojectSpatial">spReprojectSpatial()</a></td>
<td>Reprojects a sf object.</td>
</tr>
<tr class="odd">
<td><a href="#spClipPoint">spClipPoint()</a></td>
<td>Subset points with a Spatial polygon layer.</td>
</tr>
<tr class="even">
<td><a href="#spClipPoly">spClipPoly()</a></td>
<td>Subset Spatial polygons layer with another Spatial polygons layer.</td>
</tr>
<tr class="odd">
<td><a href="#spClipRast">spClipRast()</a></td>
<td>Subset raster layer with a Spatial polygons layer.</td>
</tr>
<tr class="even">
<td><a href="#spExtractPoly">spExtractPoly()</a></td>
<td>Extracts point attribute values from Spatial polygons layer(s).</td>
</tr>
<tr class="odd">
<td><a href="#spExtractRast">spExtractRast()</a></td>
<td>Extracts point attribute values from raster layer(s).</td>
</tr>
<tr class="even">
<td><a href="#spStrata">spStrata()</a></td>
<td>Extracts point attribute values and pixel counts for strata spatial layers.</td>
</tr>
<tr class="odd">
<td><a href="#spUnionPoly">spUnionPoly()</a></td>
<td>Generates one Spatial polygons object from two Spatial polygons layers.</td>
</tr>
<tr class="even">
<td><a href="#spZonalRast">spZonalRast()</a></td>
<td>Extracts summary statistics by polygon (i.e., zone) for a raster.</td>
</tr>
</tbody>
</table>
</div>
<div id="objective-of-tutorial" class="section level3">
<h3>Objective of tutorial</h3>
<p>The objective of this tutorial is to demonstrate how to use FIESTA’s spatial tools for manipulating and summarizing spatial data. The examples use data from two inventory years of field measurements in the state of Wyoming, from FIADB_1.7.2.00, last updated June 20, 2018, downloaded on June 25, 2018 and stored as internal data objects in FIESTA.</p>
</div>
</div>
<div id="example-data---wyoming-wy-inventory-years-2011-2012" class="section level2">
<h2>Example data - Wyoming (WY), Inventory Years 2011-2012</h2>
<table>
<thead>
<tr class="header">
<th>Data Frame</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>WYplt</td>
<td>WY plot-level data</td>
</tr>
<tr class="even">
<td>WYcond</td>
<td>WY condition-level data</td>
</tr>
<tr class="odd">
<td>WYtree</td>
<td>WY tree-level data</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="27%"></col>
<col width="72%"></col>
</colgroup>
<thead>
<tr class="header">
<th>External data</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>WYbighorn_adminbnd.shp</td>
<td>Polygon shapefile of WY Bighorn National Forest Administrative boundary*</td>
</tr>
<tr class="even">
<td>WYbighorn_districtbnd.shp</td>
<td>Polygon shapefile of WY Bighorn National Forest District boundaries**</td>
</tr>
<tr class="odd">
<td>WYbighorn_forest_nonforest_250m.tif</td>
<td>GeoTIFF raster of predicted forest/nonforest (1/0) for stratification***</td>
</tr>
<tr class="even">
<td>WYbighorn_dem_250m.img</td>
<td>Erdas Imagine raster of elevation change, in meters****</td>
</tr>
</tbody>
</table>
<p>*USDA Forest Service, Automated Lands Program (ALP). 2018. S_USA.AdministrativeForest (). Description: An area encompassing all the National Forest System lands administered by an administrative unit. The area encompasses private lands, other governmental agency lands, and may contain National Forest System lands within the proclaimed boundaries of another administrative unit. All National Forest System lands fall within one and only one Administrative Forest Area.</p>
<p>**USDA Forest Service, Automated Lands Program (ALP). 2018. S_USA.RangerDistrict (<a href="http://data.fs.usda.gov/geodata/edw" class="uri">http://data.fs.usda.gov/geodata/edw</a>). Description: A depiction of the boundary that encompasses a Ranger District.</p>
<p>***Based on MODIS-based classified map resampled from 250m to 500m resolution and reclassified from 3 to 2 classes: 1:forest; 2:nonforest. Projected in Albers Conical Equal Area, Datum NAD27 (Ruefenacht et al. 2008). Clipped to extent of WYbighorn_adminbnd.shp.</p>
<p>****USGS National Elevation Dataset (NED), resampled from 30m resolution to 250m. Projected in Albers Conical Equal Area, Datum NAD27 (U.S. Geological Survey 2017). Clipped to boundary of WYbighorn_adminbnd.shp.</p>
<div id="examples" class="section level3">
<h3>EXAMPLES</h3>
<p>Set up for examples</p>
<pre><code># Load library
library(FIESTA)


# Set workspace to FIESTA folder (create if doesn't exist)
if (!file.exists(&quot;C:/FIESTA&quot;))  dir.create(&quot;C:/FIESTA&quot;)
setwd(&quot;C:/FIESTA&quot;)

# Create 2 subfolders under the FIESTA folder, 'data' and 'outfolder' and set path to objects 
if (!file.exists(&quot;data&quot;))  dir.create(&quot;data&quot;)
datfolder &lt;- &quot;data&quot; 

if (!dir.exists(&quot;outfolder&quot;)) dir.create(&quot;outfolder&quot;)
outfolder &lt;- &quot;outfolder&quot;

# File names for external spatial data
WYbhfn &lt;- system.file(&quot;extdata&quot;, &quot;sp_data/WYbighorn_adminbnd.shp&quot;, package=&quot;FIESTA&quot;)
WYbhdistfn &lt;- system.file(&quot;extdata&quot;, &quot;sp_data/WYbighorn_districtbnd.shp&quot;, package=&quot;FIESTA&quot;)
WYbhdist.att &lt;- &quot;DISTRICTNA&quot;

fornffn &lt;- system.file(&quot;extdata&quot;, &quot;sp_data/WYbighorn_forest_nonforest_250m.tif&quot;, package=&quot;FIESTA&quot;)
demfn &lt;- system.file(&quot;extdata&quot;, &quot;sp_data/WYbighorn_dem_250m.img&quot;, package=&quot;FIESTA&quot;)


# Other spatial layers used for examples, extracted using the raster package, getData function.
# County-level boundaries for USA and subset for Wyoming (Note: must have internet connection)
USAco &lt;- raster::getData('GADM', country=&quot;USA&quot;, level=2)    
head(USAco@data)
WYco &lt;- USAco[USAco$NAME_1 == &quot;Wyoming&quot;,]


</code></pre>
<div id="spimportshape" class="section level4">
<h4><a name="spImportShape"></a>spImportShape()</h4>
<pre><code>###################################################################################
# Usage:
# spImportSpatial(layer = NULL, dsn = NULL, polyfix = FALSE, gui = FALSE) 
# 
# Description:
# Import a spatial layer (e.g., ESRI Shapefile) to a simple feature (sf) object.
###################################################################################

## Import external data shapefiles
WYbh &lt;- spImportSpatial(WYbhfn)
WYbhdist &lt;- spImportSpatial(WYbhdistfn)

## Display boundary
plot(sf::st_geometry(WYbhdist), border=&quot;blue&quot;)
plot(sf::st_geometry(WYbh), add=TRUE)

</code></pre>
</div>
<div id="spexportspatial" class="section level4">
<h4><a name="spExportSpatial"></a>spExportSpatial()</h4>
<pre><code>###################################################################################
# Usage:
# spExportSpatial(sfobj, out_fmt = &quot;shp&quot;, outfolder = NULL, out_dsn = NULL,   
#         out_layer = NULL, outfn.pre = NULL, outfn.date = TRUE, overwrite_dsn = FALSE, 
#       overwrite_layer = NULL, append = FALSE) 
# 
# Description:
# Exports an sf object.
###################################################################################

## Export Spatial Polygons layer to a shapefile
spExportSpatial(WYbh, out_dsn=&quot;WYbh.shp&quot;, outfolder=outfolder, overwrite_dsn=TRUE)

## Check outfolder and display in ArcMap

</code></pre>
</div>
<div id="spmakespatialpoints" class="section level4">
<h4><a name="spMakeSpatialPoints"></a>spMakeSpatialPoints()</h4>
<pre><code>###################################################################################
# Usage:
# spMakeSpatialPoints(xyplt, xyplt_dsn = NULL, xy.uniqueid = NULL, 
#   xvar = NULL, yvar = NULL, xy.crs = 4269, prj = NULL, datum = NULL, zone = NULL,
#   zoneS = FALSE, aea.param = &quot;USGS&quot;, addxy = FALSE, exportsp = FALSE, ...) 
# 
# Description:
# Generates sf points object with defined projection.
###################################################################################

## Generate sf object from the WY plot data (x=LON_PUBLIC, y=LAT_PUBLIC) 
## Note: The coordinate reference system (crs) is: prj=longlat, datum=NAD83.

head(WYplt)
WYspplt &lt;- spMakeSpatialPoints(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, xvar=&quot;LON_PUBLIC&quot;, 
        yvar=&quot;LAT_PUBLIC&quot;, prj=&quot;longlat&quot;, datum=&quot;NAD83&quot;)
WYspplt        
        
## ... or use EPSG code
WYspplt &lt;- spMakeSpatialPoints(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, xvar=&quot;LON_PUBLIC&quot;, 
        yvar=&quot;LAT_PUBLIC&quot;, xy.crs=4269)
WYspplt 
        
        
        
## Display output
plot(sf::st_geometry(WYbhdist))
plot(sf::st_geometry(WYspplt), add=TRUE)

## NOTE: To display multiple layers, all layers must be in the same coordinate system.
lapply(list(WYbh, WYbhdist, WYspplt), sf::st_crs)

## Export spatial points to outfolder
WYspplt &lt;- spMakeSpatialPoints(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, xvar=&quot;LON_PUBLIC&quot;, 
        yvar=&quot;LAT_PUBLIC&quot;, xy.crs=4269, exportsp=TRUE, out_dsn=&quot;spplt&quot;, out_fmt=&quot;shp&quot;,
        outfolder=outfolder, outfn.pre=&quot;WY&quot;, overwrite_layer=TRUE)

</code></pre>
</div>
<div id="spreprojectvector" class="section level4">
<h4><a name="spReprojectVector"></a>spReprojectVector()</h4>
<pre><code>###################################################################################
# Usage:
# spReprojectVector(layer, dsn = NULL, crs.new = NULL, prj.new = NULL, 
#     datum.new = NULL, ellps.new = NULL, zone.new = FALSE, 
#     zoneS.new = FALSE, aea.param.new = &quot;USGS&quot;, exportsp = FALSE, ...) 
# 
# Description:
# Reprojects spatial vector layer. 
# NOTE: The layer must have a defined coordinate reference system. 
##      Test using sf::st_crs(x).
###################################################################################

## Reproject a vector Spatial object or file. 
sf::st_crs(WYspplt)
prj &lt;- &quot;+proj=utm +zone=12 +ellps=GRS80 +datum=NAD83 +units=m +no_defs&quot;
WYspplt.utm12 &lt;- spReprojectVector(layer=WYspplt, crs.new=prj)
        
## Check results
sf::st_crs(WYspplt.utm12)

</code></pre>
</div>
<div id="spclippoint" class="section level4">
<h4><a name="spClipPoint"></a>spClipPoint()</h4>
<pre><code>###################################################################################
# Usage:
# spClipPoint(xyplt, xyplt_dsn = NULL, xy.uniqueid = &quot;PLT_CN&quot;, 
#     clippolyv, clippolyv_dsn = NULL, clippolyv.filter = NULL, showext = FALSE,  
#     keepNA = FALSE, savedata = FALSE, returnsp = TRUE, exportsp = FALSE, 
#     outfolder = NULL, out_fmt = &quot;shp&quot;, out_dsn = NULL, out_layer = &quot;pnt&quot;, 
#     outfn.pre = NULL, outfn.date = FALSE, overwrite = FALSE, 
#     othertabnms = NULL, ...) 
# 
# Description:
# Subset SpatialPoints or point file with a Spatial polygon boundary.
###################################################################################

## Get points within Bighorn National Forest boundary (project on the fly)
WYbhptslst &lt;- spClipPoint(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, clippolyv=WYbh, 
    xvar=&quot;LON_PUBLIC&quot;, yvar=&quot;LAT_PUBLIC&quot;, prj=&quot;longlat&quot;, datum=&quot;NAD83&quot;)
names(WYbhptslst)
WYbhspplt &lt;- WYbhptslst$clip_xyplt
WYbhprj &lt;- WYbhptslst$clip_poly

## Check and display output
WYbhspplt
plot(sf::st_geometry(WYbhprj), border=&quot;red&quot;, lwd=2)
plot(sf::st_geometry(WYbhspplt), add=TRUE)


## NOTE: If the projection of spplt is not the same as the points layer, the  
##   points layer will be reprojected to the same projection as clippolyv 
##   (See notes in help file for more info).


## Generate a sf object first, then clip sf points 
WYspplt &lt;- spMakeSpatialPoints(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, xvar=&quot;LON_PUBLIC&quot;, 
        yvar=&quot;LAT_PUBLIC&quot;, xy.crs=4269)
WYbhptslst &lt;- spClipPoint(xyplt=WYspplt, xy.uniqueid=&quot;CN&quot;, clippolyv=WYbh)


## Subset other tables with clipped points
WYbhptslst &lt;- spClipPoint(xyplt=WYspplt, xy.uniqueid=&quot;CN&quot;, clippolyv=WYbh, 
        othertabnms=c(&quot;WYcond&quot;, &quot;WYtree&quot;))
names(WYbhptslst)


 
## Export clipped points
spExportSpatial(WYbhspplt, out_layer=&quot;WYbhpts&quot;, outfolder=outfolder, overwrite_layer=TRUE)


## Get points within Bighorn National Forest boundary (project on the fly)
## Save to outfolder
WYbhptslst &lt;- spClipPoint(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, clippolyv=WYbh, 
    xvar=&quot;LON_PUBLIC&quot;, yvar=&quot;LAT_PUBLIC&quot;, prj=&quot;longlat&quot;, datum=&quot;NAD83&quot;,
    othertabnms=c(&quot;WYcond&quot;, &quot;WYtree&quot;), exportsp=TRUE, outfolder=outfolder, 
    overwrite=TRUE, outfn.pre=&quot;clip&quot;)
    
names(WYbhptslst)


</code></pre>
</div>
<div id="spclippoly" class="section level4">
<h4><a name="spClipPoly"></a>spClipPoly()</h4>
<pre><code>###################################################################################
# Usage:
# spClipPoly(polyv, polyv_dsn = NULL, clippolyv, clippolyv_dsn = NULL, 
#     clippolyv.filter = NULL, showext = FALSE, areacalc = FALSE, areaunits = &quot;ACRES&quot;,  
#       exportsp = FALSE, ...) 
# 
# Description:
# Clip (intersect) polygon vector layer with polygon vector layer.
###################################################################################


## Subset the USAco SpatialPolygons layer with WYbighorn
## NOTE: must download USAco from raster package. See above Example set up.
WYbhco &lt;- spClipPoly(polyv=USAco, clippolyv=WYbh)

## Check and display WYbighorn_co with labels
head(WYbhco)
plot(sf::st_geometry(WYbhco['NAME_2']), col=sf.colors(nrow(WYbhco)))
coords &lt;- st_coordinates(st_centroid(st_geometry(WYbhco)))
text(coords[,&quot;X&quot;], coords[,&quot;Y&quot;], WYbhco[[&quot;NAME_2&quot;]])

</code></pre>
</div>
<div id="spcliprast" class="section level4">
<h4><a name="spClipRast"></a>spClipRast()</h4>
<pre><code>######################################################################################
# Usage:
# spClipRast(rast, rastfolder = NULL, clippolyv, clippolyv_dsn = NULL, 
#       clippolyv.filter = NULL, rast.crs = NULL, bands = NULL, NODATA = NULL, 
#     buffdist = NULL, maskByPolygons = TRUE, showext = FALSE, setNODATA = FALSE, 
#     fmt = &quot;HFA&quot;, outfolder = NULL, outfn = &quot;rastclip&quot;, outfn.pre = NULL, 
#     outfn.date = FALSE, overwrite = FALSE)
# 
# Description:
# Subsets a raster to a polygon extent or boundary.
######################################################################################

## Subset the strata layer with the Medicine Wheel district boundary.
WYbhdist
WYbhMW &lt;- WYbhdist[WYbhdist$DISTRICTNA == &quot;Medicine Wheel Ranger District&quot;,]

plot(st_geometry(WYbhdist))
plot(st_geometry(WYbhMW), border=&quot;red&quot;, add=TRUE)


WYbhMW.fornf &lt;- spClipRast(fornffn, clippolyv=WYbhMW, outfolder=outfolder)

## Display results
sp::plot(raster::raster(WYbhMW.fornf))


## NOTE: If the projection of polyv is not the same as rast, polyv will by reprojected
##   to the same projection as rast before clipping (See note in help file for more details).

</code></pre>
</div>
<div id="spextractpoly" class="section level4">
<h4><a name="spExtractPoly"></a>spExtractPoly()</h4>
<pre><code>######################################################################################
# Usage:
# spExtractPoly(xyplt, xyplt_dsn = NULL, uniqueid = &quot;PLT_CN&quot;, polyvlst,
#     polyv_dsn = NULL, polyvarlst = NULL, polyvarnmlst = NULL, keepNA = FALSE, 
#       showext = FALSE, savedata = FALSE, exportsp = FALSE, exportNA = FALSE,
#     out_fmt = &quot;shp&quot;, out_dsn = NULL, out_layer = &quot;polyext&quot;, outfolder = NULL,
#       outfn.pre = NULL, outfn.date = TRUE, overwrite = TRUE, ...) 
# 
# Description:
# Subset Spatial polygons layer with another Spatial polygons layer. 
######################################################################################

## Extract polygon attributes from WYbighorn to WYpts, keeping NULL values
extpolylst &lt;- spExtractPoly(WYspplt, uniqueid=&quot;CN&quot;, polyvlst=WYbhdist)
WYspplt_bh &lt;- extpolylst$sppltext

dim(WYspplt)
dim(WYspplt_bh)

head(WYspplt_bh)
plot(WYspplt_bh[&quot;DISTRICTNA&quot;])



## NOTE: If the projection of spplt is not the same as the Spatial Points, the Spatial 
##   Points layer will be reprojected to the same projection as clippolyv before the 
##   evaluation points (See note in help file for more details).


## Extract a subset of polygon attributes from WYbighorn to WYpts, not keeping NULL values
extpolylst &lt;- spExtractPoly(WYspplt, uniqueid=&quot;CN&quot;, polyvlst=WYbh, 
          polyvarlst=c(&quot;FORESTNUMB&quot;, &quot;FORESTNAME&quot;), keepNA=FALSE)
WYspplt_bh2 &lt;- extpolylst$sppltext

dim(WYspplt)
dim(WYspplt_bh2)

head(WYspplt_bh2)

</code></pre>
</div>
<div id="spextractrast" class="section level4">
<h4><a name="spExtractRast"></a>spExtractRast()</h4>
<pre><code>######################################################################################
# Usage:
# spExtractRast(xyplt, xyplt_dsn = NULL, uniqueid = &quot;PLT_CN&quot;, rastlst, 
#     rastfolder = NULL, rast.crs = NULL, bandlst = NULL, var.name = NULL, 
#       interpolate = FALSE, windowsize = 1, windowstat = NULL, rast.NODATA = NULL, 
#       keepNA = TRUE, showext = FALSE, savedata = FALSE, exportsp =  FALSE, 
#       exportNA = FALSE, outfolder = NULL, out_fmt = &quot;shp&quot;, out_dsn = NULL, 
#     out_layer = &quot;rastext&quot;, outfn.pre = NULL, outfn.date = TRUE, 
#     overwrite=FALSE, ...)
# 
# Description:
# Subset Spatial polygons layer with another Spatial polygons layer.
######################################################################################

## Extract raster values from WYdem to WYpts, not keeping NULL values
extrastlst &lt;- spExtractRast(WYspplt, rastlst=c(fornffn, demfn), uniqueid=&quot;CN&quot;, keepNA=FALSE)
WYspplt_dem &lt;- extrastlst$sppltext

dim(WYspplt)
dim(WYspplt_dem)

head(WYspplt_dem)

</code></pre>
</div>
<div id="spgetplots" class="section level4">
<h4><a name="spGetPlots"></a>spGetPlots()</h4>
<pre><code>######################################################################################
# Usage:
# spGetPlots(bnd, bnd_dsn = NULL, bnd.filter = NULL, states = NULL, stbnd = NULL, 
#       stbnd_dsn = NULL, stbnd.att = NULL, RS = NULL, xy = NULL, xy_dsn = NULL, 
#     xy.uniqueid = &quot;PLT_CN&quot;, xvar = &quot;LON_PUBLIC&quot;, yvar = &quot;LAT_PUBLIC&quot;, xy.crs = 4269,
#     xy.joinid = &quot;PLT_CN&quot;, clipxy = TRUE, datsource = &quot;datamart&quot;, data_dsn = NULL, 
#     istree = TRUE, plot_layer = &quot;plot&quot;, cond_layer = &quot;cond&quot;, tree_layer = &quot;tree&quot;, 
#     puniqueid = &quot;CN&quot;, evalid = NULL, evalCur = FALSE, evalType = &quot;01&quot;, 
#     measCur = FALSE, Endyr = NULL, invyrs = NULL, intensity1 = FALSE,  
#     showsteps = FALSE, savedata = FALSE, savexy =  FALSE, outfolder = NULL, 
#     out_fmt = &quot;shp&quot;, out_dsn = NULL, outfn.pre = NULL, outfn.date = FALSE, 
#       overwrite_dsn = FALSE, overwrite_layer = FALSE, ...) 
# 
# Description:
# Wrapper to get FIA plots within the boundary population (area of interest).
######################################################################################


## Extract public coordinates within WY Bighorn NF boundary
WYbhdat &lt;- spGetPlots(bnd=WYbhfn, states=&quot;Wyoming&quot;, datsource=&quot;datamart&quot;, evalCur=TRUE)
names(WYbhdat)

</code></pre>
</div>
<div id="spgetmodeldat" class="section level4">
<h4><a name="spGetModeldat"></a>spGetModeldat()</h4>
<pre><code>######################################################################################
# Usage:
# spGetModeldat(xyplt, xyplt_dsn = NULL, xyplt = NULL, uniqueid = &quot;PLT_CN&quot;, 
#     module = &quot;SA&quot;, domtype = &quot;POLY&quot;, dom_layer = NULL, dom_dsn = NULL, 
#       domvar = &quot;DOMAIN&quot;, rastlst.cont = NULL, rastlst.cont.name = NULL, 
#     rastlst.cont.stat = &quot;MEAN&quot;, rastlst.cont.NODATA = NULL, rastlst.cat = NULL, 
#     rastlst.cat.name = NULL, rastlst.cat.NODATA = NULL, rastfolder = NULL,
#       asptransform = FALSE, rast.asp = NULL, rast.lut = NULL, rastlut = NULL,
#     areacalc = TRUE, areaunits = &quot;ACRES&quot;, keepNA = FALSE, NAto0 = TRUE,
#     showext = TRUE, savedata = FALSE, exportsp = FALSE, exportNA =  FALSE,
#     outfolder = NULL, out_fmt = &quot;csv&quot;, out_dsn = NULL, outfn.pre = NULL, 
#     outfn.date = TRUE, overwrite = FALSE, vars2keep = NULL, ...) 
# 
# Description:
# Wrapper function to get data extraction and zonal statistics for Model-assisted or
#       Model-based (Small Area) Estimation. The major steps are as follows:
#   1) Check parameters 
#   2) Extract point values from domlayer
#   3) Set up output data structures
#   4) Extract point values and get zonal statistics from continuous raster layers
#   5) Extract point values and get zonal statistics from categorical raster layers
#   6) Get total acres from domlayer (if areacalc=TRUE)
######################################################################################

## Generate a sf object from the WY plot data, public coordinates 
## (x=LON_PUBLIC, y=LAT_PUBLIC) 
## Note: The public coordinate projection information is: prj=longlat, datum=NAD83.
WYspplt &lt;- spMakeSpatialPoints(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, xvar=&quot;LON_PUBLIC&quot;, 
        yvar=&quot;LAT_PUBLIC&quot;, xy.crs=4269)
        
## Derive new layers from dem
library(raster)
dem &lt;- raster(demfn)
slp &lt;- terrain(dem, opt=&quot;slope&quot;, unit=&quot;degrees&quot;, 
  filename=paste0(outfolder, &quot;/WYbh_slp.img&quot;), overwrite=TRUE)
asp &lt;- terrain(dem, opt=&quot;aspect&quot;, unit=&quot;degrees&quot;, 
  filename=paste0(outfolder, &quot;/WYbh_asp.img&quot;), overwrite=TRUE)


## Extract estimation unit and zonal raster statistics (i.e., mean) 
rastlst.cont &lt;- c(demfn, slp, asp)
rastlst.cont.name &lt;- c(&quot;dem&quot;, &quot;slp&quot;, &quot;asp&quot;)
rastlst.cat &lt;- fornffn
rastlst.cat.name=&quot;fornf&quot;

modeldat &lt;- spGetModeldat(xyplt=WYspplt, uniqueid=&quot;CN&quot;, dom_layer=WYbhfn, 
  domvar=NULL, rastlst.cont=rastlst.cont, rastlst.cont.name=rastlst.cont.name, 
  rastlst.cat=rastlst.cat, rastlst.cat.name=rastlst.cat.name, rastlst.cont.stat=&quot;mean&quot;,
  rast.NODATA=0, asptransform=TRUE, rast.asp=asp, keepNA=FALSE, showext=FALSE, 
  savedata=FALSE)
names(modeldat)

sppltmodel &lt;- modeldat$pltassgn
unitmodel &lt;- modeldat$domzonal
unitvar &lt;- modeldat$domvar
inputdf &lt;- modeldat$inputdf
unitarea &lt;- modeldat$domarea
areavar &lt;- modeldat$areavar
inputdf &lt;- modeldat$inputdf
prednames &lt;- modeldat$prednames
zonalnames &lt;- modeldat$zonalnames

unitvar
areavar
unitmodel
unitarea
head(sppltmodel)

prednames
zonalnames

</code></pre>
</div>
<div id="spgetstrata" class="section level4">
<h4><a name="spGetStrata"></a>spGetStrata()</h4>
<pre><code>######################################################################################
# Usage:
# spGetStrata(xyplt, xyplt_dsn = NULL, uniqueid = &quot;PLT_CN&quot;, unittype = &quot;POLY&quot;,
#     unit_layer = NULL, unit_dsn = NULL, unitvar = NULL, unit.filter = NULL, 
#     strattype = &quot;RASTER&quot;, strat_layer = NULL, strat_dsn = NULL, strvar = NULL, 
#       strat_lut = NULL, areaunits = &quot;ACRES&quot;, rast.NODATA = NULL, keepNA = FALSE, 
#     showext = TRUE, savedata = FALSE, exportsp = FALSE, exportNA = FALSE, 
#     outfolder = NULL, out_fmt = &quot;shp&quot;, out_dsn = NULL, out_layer = &quot;strat_assgn&quot;, 
#     outfn.date = TRUE, outfn.pre = NULL, overwrite = FALSE, ...) 
# 
# Description:
# Wrapper to extract attribute and area from a polygon or raster estimation 
#   unit laer and a polygon or raster layer with strata pixel categories.
######################################################################################

## Generate a sf object from the WY plot data, public coordinates 
## (x=LON_PUBLIC, y=LAT_PUBLIC) 
## Note: The public coordinate projection information is: prj=longlat, datum=NAD83.
WYspplt &lt;- spMakeSpatialPoints(xyplt=WYplt, xy.uniqueid=&quot;CN&quot;, xvar=&quot;LON_PUBLIC&quot;, 
        yvar=&quot;LAT_PUBLIC&quot;, xy.crs=4269)

## Extract polygon attributes from WYbighorn to WYpts, keeping NULL values
stratlst &lt;- spGetStrata(WYspplt, uniqueid=&quot;CN&quot;, unittype=&quot;POLY&quot;, unit_layer=WYbhfn,
     strattype=&quot;RASTER&quot;, strat_layer=fornffn) 
names(stratlst) 

pltassgn &lt;- stratlst$pltassgn
unitarea &lt;- stratlst$unitarea
stratalut &lt;- stratlst$stratalut

head(pltassgn)
unitarea
head(stratalut)
stratlst$strvar
stratlst$unitvar

</code></pre>
</div>
<div id="spunionpoly" class="section level4">
<h4><a name="spUnionPoly"></a>spUnionPoly()</h4>
<pre><code>######################################################################################
# Usage:
# spUnionPoly(polyv1, polyv1_dsn = NULL, polyv2, polyv2_dsn = NULL, showext = TRUE,
#     areacalc = FALSE, areavar = &quot;ACRES_GIS&quot;, exportsp = FALSE, ...)
# 
# Description:
# Generate a unioned sf object with polygons and attribtutes from two sf polygon objects..
######################################################################################
WYbh &lt;- spImportSpatial(WYbhfn)

## Extract polygon attributes from WYbighorn to WYpts, keeping NULL values
polyUnion &lt;- spUnionPoly(polyv1=USAco[USAco$NAME_1 == &quot;Wyoming&quot;,], polyv2=WYbh, 
      areacalc=TRUE)

plot(st_geometry(polyUnion))
head(polyUnion)

</code></pre>
</div>
<div id="spzonalrast" class="section level4">
<h4><a name="spZonalRast"></a>spZonalRast()</h4>
<pre><code>######################################################################################
# Usage:
# spZonalRast(polyv, polyv_dsn = NULL, polyv.att = NULL, rast, rastfolder = NULL, 
#     polyatt = NULL, bands = NULL, zonalstat = NULL, pixelfun = NULL, outname = NULL, 
#     showext = FALSE, rastlut = NULL, rast.NODATA = NULL, na.rm = TRUE, 
#     savedata = FALSE, outfolder = NULL, outfn = &quot;zonalext&quot;, outfn.pre = NULL, 
#     outfn.date = FALSE, overwrite = FALSE) 
# 
# Description:
# Extracts summary statistics by polygon (i.e., zone).
######################################################################################
WYbhdist &lt;- spImportSpatial(WYbhdistfn)

## Extract polygon attributes from WYbighorn to WYpts, keeping NULL values
zonallst &lt;- spZonalRast(polyv=WYbhdist, polyv.att=&quot;DISTRICTNA&quot;, rast=demfn, 
      zonalstat=c(&quot;mean&quot;, &quot;sum&quot;)) 
names(zonallst) 

zonalext &lt;- zonallst$zonalext
outname &lt;- zonallst$outname
rasterfile &lt;- zonallst$rasterfile

head(zonalext)
outname
rasterfile

</code></pre>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
