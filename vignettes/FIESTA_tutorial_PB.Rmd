---
title: "FIESTA - Photo-Based Module"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{FIESTA - Photo-Based Module}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---


## FIESTA Overview
The R package, FIESTA (Forest Inventory ESTimation and Analysis) is a research estimation tool for analysts that work with sample-based inventory data from the U.S. Department of Agriculture, Forest Service, Forest Inventory and Analysis (FIA) Program to accommodate: unique population boundaries, different evaluation time periods, customized stratification schemes, non-standard variance equations, integration of multi-scale remotely-sensed data and other ancillary information, and interaction with other modeling and estimation tools from CRAN R's library of packages. FIESTA contains a collection of functions that can access FIA databases, summarize and compile plot and spatial data, and generate estimates with associated sampling errors. 


Functions are organized by type or objective and are named with a corresponding prefix: 

**Core Functions**

* Database tools (DB) - functions for querying and extracting data from FIA's national database.
* Data tools (dat) - functions for summarizing and exploring FIA data.
* Spatial tools (sp) - functions for manipulating and summarizing spatial data.

**Estimation Modules (mod)**

* Green-Book (modGB) - functions for FIA's standard Green-Book estimators.
* Photo-Based (modPB) - functions for supplementary photo-based estimators.
* Small Area (modSA) - functions for integration with available small area estimators (SAE).
* Model-Assisted (modMA) - functions for integration with available Model-Assisted estimators.

**Analysis Tools**

* Analysis tools (an) - wrapper functions for steam-lining estimation processes.


### Photo-based (PB) module overview
FIESTA's Photo-Based (PB) module calculates population estimates and associated sampling errors based on Patterson (2012). In contrast to FIA's traditional green-book estimators which were constructed based on the finite sampling paradigm using sample plots with distinct area, the photo-based estimators were constructed based on the context of the infinite sampling paradigm, along with the concept of a support region. The sample is the set of plot centers and the information from the support region (the photo plot) is assigned to the plot centers. The photo interpreted points are used as a sample of the support region and the measurements are used to estimate the information from the support region. FIESTA includes non-ratio estimators for area and percent cover estimates by domain and ratio-of-means estimators for area and percent cover estimates within domain, and supports post-stratification for reducing variance.

### Objective of tutorial
The main objective of this tutorial is to demonstrate how to use FIESTA for generating estimates, supplementary to FIA's traditional estimates, using photo-based estimators from Patterson (2012). 


* [FIESTA parameters](#input)
* [FIESTA output from Photo-Based module](#output)
* [PB Functions and Examples](#PBfun)
 


<a name="input"></a>

### FIESTA PB module parameters - modPB()
The PB module was originally developed for the Nevada Photo-Based Inventory Pilot (NPIP; Frescino et al. 2009), based on the infinite sampling paradigm. The module was since updated for use with other photo-based data that are consistent with the infinite sampling paradigm and an equal probability sample design. The PB module consists of one function that generates: 1) estimates of area or cover by domain (nonratio); or 2) estimates of area or cover within domain (ratio). The parameters for PB functions can be organized into categories defined by specific requirements or customizations: 


1. [Data tables and unique identifiers of points and plot](#dtab) 
2. [Estimation type](#etyp)    
3. [Filters to subset table records](#filt)
4. [Estimation unit information](#estunit)
5. [Stratification information](#strat)
6. [Output table information](#out1)
7. [Output table specifications](#out2)
8. [Output table title(s)](#title)



<a name="dtab"></a>
**Data tables, unique identifiers, number of points**

A data table of individual or aggregated point data is required input to the modPB function. Plot-level information, such as: state, county, or strata assignment, may be included in pltassgn or in pnt, or pltpct with pltassgn=NULL. The parameter input can be the name of a comma-delimited file (\*.csv) or an R data frame or data table object already loaded into R. The pltassgn table can also be a point shapefile (\*.shp) or a SpatialDataFrame object with one point per plot. The unique identifier for the plots must be provided in pltassgn and pnt and the unique identifier for the points must additionally in pnt. See the required variables section for a list of variables necessary to include for estimation.

* **pnt**       - Point-level data, with 1 record per point. If NULL, aggregated point counts must be in pntcnt.
* **pltpct**    - Plot-domain-level data, with 1 record per domain per plot.
* **plotid** - Unique identifier for a plot in pnt or pntcnt. Values match puniqueid values in pltassgn.
* **pntid** - Unique identifier for a point in pnt.
* **pltpctvars** - Variables in pltpct for estimation. If NULL, all variables are used except plotid in pltpct.
* **pltassgn**  - Plot-level data, with 1 record per plot, including estimation unit and/or strata information. Optional.
* **puniqueid** - Unique identifier for a plot in pltassgn, if pltassgn is not NULL. 


<a name="etyp"></a>
**Estimation type**

Define the type of estimation: output units (PCT, AREA); summed estimation units; post-stratify; if ratio estimate, what type of ratio.

* **ratio**     - TRUE, ratio estimates are generated.
* **tabtype**   - Type of units for the table (PCT, AREA) (Default=PCT).
* **sumunits**  - TRUE, sum estimates by estimation units (subpopulations) into one estimate (e.g, Counties to State).
* **strata**    - TRUE, use stratification for variance reduction.


<a name="filt"></a>
**Filters**

Filters subset the area of the sample population. *All filter expressions must be in R syntax*.

* **landarea**        - Land area description (ALL, CHANGE).
* **landarea.filter** - Land area filter, specifying land area to estimate.
* **nonsamp.filter**  - A filter for nonsampled points.
* **pnt.filter**      - A filter for pnt file.
* **plt.filter**      - Plot-level filter(s)


<a name="estunit"></a>
**Estimation unit information**

An estimation unit is a population, or area of interest, with known area and number of plots. As an example, in Interior-West FIA, an estimation unit is generally an individual county. An estimation unit may be a subpopulation of a larger population (e.g., Counties within a State). Subpopulations are mutually exclusive and independent within a population, therefore estimated totals and variances are additive. Each plot is assigned to only one estimation unit based on plot center and can be stored in either pltassgn or cond. 

* **unitvar** - Name of the estimation unit variable in cond or pltassgn with assignment for each plot (e.g., 'ESTN_UNIT').
* **unitarea**  - Total acres by estimation unit. If only 1 estimation unit, include a number representing total acreage for the area of interest. If more than one estimation unit, provide a data frame/data table of total acres by estimation unit, with variables defined by unitvar and areavar. 
* **areavar**   - Name of acre variable in unitarea (Default = "ACRES").


<a name="strat"></a>
**Strata information**

Stratification is used to reduce variance in population estimates by partitioning the population into homogenous classes (strata), such as forest and nonforest. For stratified sampling methods, the strata sizes (weights) must be either known or estimated. Remotely-sensed data is often used to generate strata weights with proporation of pixels by strata. If stratification is desired (strata=TRUE), the required data include: stratum assignment for the center location of each plot, stored in either pltassgn or cond; and a look-up table with the area, pixel count, or proportion of the total area (strwt) of each strata value by estimation unit, making sure the name of the strata (and estimation unit) variable and values match the plot assignment name(s) and value(s). If strata (and estimation unit) variables are included in cond, all conditions in a plot must have the same strata (and estimation unit) value.

* **stratalut** - Look-up table with pixel counts, area, or proportions (strwt) by strata (and estimation unit).
* **strvar**    - Name of strata variable in stratalut and pltassgn or cond table with strata assignment for each plot.
* **getwt**     - If TRUE, calculates strata weights from getwtvar in stratalut.
* **getwtvar**  - Name of variable in stratalut to calculate weights (e.g., pixels counts). Default="P1POINTCNT". 
* **autocombine** - TRUE, an automated procedure occurs to combine strata and/or estimation units if less than 2 plots (See note below for more details).


Note: 
A minimum of 2 plots per strata is necessary for stratification. If there are less than 2 plots in any strata/estimation combination, an error occurs with a message to collapse classes. If autocombine=TRUE, an automated procedure occurs to collapse all strata/estimation unit combinations that have 10 or less plots (Paul ref). The procedure collapses classes based on the order of estimation units in stratalut. If an estimation unit has 10 or less plots, it is grouped with the estimation unit following in the table. If it is the last estimation unit in the table, it is grouped with the estimation unit prededing in the table.   


<a name="out1"></a>
**Output table information**

The following parameters define how estimates will be generated (i.e., by domain) and how the output table will be set up (i.e., by row/column). Output tables may be: by row domain; by row domain and column domain; or for total estimates, where row and column domains are NULL. If only one domain is desired, the rowvar must be populated, leaving the colvar=NULL. Row and columns may be filtered to display specific values (rowvar.filter/colvar.filter) and may be ordered in a particular way, defined by row.orderby and col.orderby variables. A default set of code names are stored internally (FIESTA::ref_codes).

* **rowvar**        - Name of row variable (domain). If area estimate, rowvar must be from cond (e.g., FORTYPCD). If tree or ratio estimate, rowvar can be from cond or tree (e.g., SPCD).
* **rowvar.filter** - Row filter. Must be R syntax (e.g., FORTYPCD %in% 200:300).
* **colvar**        - Name of column variable (domain). If area estimate, colvar must be from cond (e.g., FORTYPCD). If tree or ratio estimate, colvar can be from cond or tree (e.g, SPCD).
* **colvar.filter** - Column filter. Must be R syntax (e.g., STDSZCD == 3).
* **row.orderby**   - Name of variable to order values of rowvar (if row.FIAname=FALSE).
* **col.orderby**   - Name of variable to order values of colvar (if col.FIAname=FALSE).
* **row.add0**      - TRUE, add 0 values in table for row values that occur in input dataset or in rowlut, but are not in final estimate.
* **col.add0**      - TRUE, add 0 values in table for column values that occur in input dataset or in rowlut, but are not in final estimate.
* **rowlut**        - A lookup table with variable codes and descriptions to include in rows of output table (See note following for more details).
* **collut**        - A lookup table with variable codes and descriptions to include in columns of output table (See note following for more details).

Note: 
rowlut/collut - There are several objectives for including rowlut/collut look-up tables: 1) to include descriptive names that match row/column codes in the input table; 2) to use number codes that match row/column names in the input table for ordering rows; 3) to add rows and/or columns with 0 values for consistency. No duplicate names are allowed.

Include 2 columns in the table: 1-the merging variable with same name as the variable in the input merge table; 2-the ordering or descriptive variable. If the ordering variable is the rowvar/colvar in the input table and the descriptive variable is in rowlut/collut, set row.orderby/col.orderby equal to rowvar/colvar. If the descriptive variable is the rowvar/colvar in the input table, and the ordering code variable is in rowlut/collut, set row.orderby/col.orderby equal to the variable name of the code variable in rowlut/collut. 


Variable names for photo point estimates. 

* **domlut**      - Look-up table of domain codes, names, and pretty name for tables.
* **domvarlst**   - A vector of variable names that can be row or column domains.


<a name="out2"></a>
**Output table specifications**

The final parameters dictate what the output will look like, such as: how to display the sample error; how many digits to round values to; whether to include a title; and whether to write the output to a folder or only return as R objects.  

* **allin1**     - TRUE, table cells include: estimates (% sample error).
* **estround**   - Number of digits to round estimates to (for GBestArea and GBestTree, default=0; for GBestRatio, default=3).
* **cvround**    - Number of digits to round % sample error to (for GBestArea and GBestTree, default=3; for GBestRatio, default=3).
* **estnull**    - Value to replace NULL values for estimates.
* **psenull**    - Value to replace NULL values for percent standard error.
* **savedata**   - TRUE, save data to outfolder.
* **rawdata**    - TRUE, if output of raw data information is desired. See output values for details.
* **outfolder**  - Name of folder to output data to (Default = working directory or window to browse).
* **outfn**      - Name of file for output data (Default = 'esttype_'estvar.name'_'rowvar'_'date'.csv').
* **outfn.pre**  - Add a prefix to output name (e.g., "01").
* **addtitle**   - TRUE, add title to tables (Default = TRUE).
* **savetitle**  - TRUE, return full table title (Default = FALSE).


<a name="title"></a>
**Title parameters**

If saving to a folder, and a title is desired, there are parameters for including a specific title or for generating a title based on pieces of information. 

* **title.main** - Full title for table.
* **title.ref**  - The ending text for table title. If not NULL, included with title.main.
* **title.rowvar**  - Pretty name for rowvar for table title (If NULL, default = rowvar).
* **title.colvar**  - Pretty name for colvar for table title (If NULL, default = colvar).
* **title.unitvar** - Pretty name for unitvar for table title (If NULL and sumunits=FALSE, default = unitvar).
* **title.estvar**  - Pretty name for estvar for table title (If NULL, default = estvar). For ratio estimates, title.estvarn (default = estvarn) and title.estvard (default = estvard).
* **title.filter**  - Pretty name for any filters for table title.
* **title.units**  - Name for area units for table title.



<a name="output"></a>

## Output values from FIESTA Photo-Based module

Estimates with percent sampling error for the row domain (and column domain) specified by the input parameters. This can be in the form of one table or two separate tables, depending on the number of domains and on allin1 parameter. 

A list object with one or more of the following components. If savedata=TRUE, all output data frames are written to outfolder.

* **$est** - Data frame with estimates by rowvar, colvar (and estimation unit). If sumunits=TRUE or one estimation unit and colvar=NULL, estimates and percent sampling error are all in est.
* **$pse** - Data frame with percent sampling errors corresponding to est.
* **$titlelst** - If savetitle=TRUE, a list with one or two titles for est and pse, depending on number of output data frames.
* **$raw** - If rawdata=TRUE, a list of raw data used in the estimation process.

### Raw data used for producing estimates (If rawdata=TRUE):

* **raw$pntsampcnt** - Number of points by domain for estimate.
* **raw$stratdat**   - Data frame of strata information by estimation unit. See table below for variable descriptions. Acres is only included if tabtype="AREA").
* **raw$pltdom.\***  - Proportion of points by domain by plot, strata, estimation unit.


```{r, results = 'asis', echo=FALSE}

stratdat.lut <- data.frame(Variable = c("ESTN_UNIT", "STRATUMCD", "P1POINTCNT", "n.strata", "n.total", "ACRES", "strwt"), Description = c("Estimation unit", "Strata value", "Number of pixels by strata and estimation unit", 
    "Number of plots in strata (and estimation unit)", "Number of plots for estimation unit", "Total acres for estimation unit", 
    "Summed proportions by strata and estimation unit"), stringsAsFactors = FALSE)

library(knitr)
kable(stratdat.lut,
  format = "pandoc",   # default
  caption = "Description of variables in stratdat.",
  col.names = names(stratdat.lut),
  row.names = FALSE,
  align = c("l"),       # align = c("c", "c", "c", "r")
  # padding = 2         # inner spacing
)



pltdom.lut <- data.frame(Variable = c("ESTN_UNIT", "STRATUMCD", "plot_id", "category", "nbrpts.pltdom", "PtsPerPlot", "p.pltdom"), Description = c("Estimation unit", "Strata value", "Unique identifier for ICE plot", 
    "Category (domain) for estimation", "Number of points by category (domain)", "Number of points interpreted", 
    "Proportion of plot by category"), stringsAsFactors = FALSE)

library(knitr)
kable(pltdom.lut,
  format = "pandoc",   # default
  caption = "Description of variables in pltdom.*.",
  col.names = names(pltdom.lut),
  row.names = FALSE,
  align = c("l"),       # align = c("c", "c", "c", "r")
  # padding = 2         # inner spacing
)


```

#### Processing data (If rawdata=TRUE)
 Separate data frames with calculated variables used in estimation process. The number of processing tables depends on the input parameters. The tables include:

* **raw$unit.totest** - Total by estimation unit 
* **raw$unit.rowest** - If rowvar != NULL, rowvar totals
* **raw$unit.colvar** - If colvar != NULL, colvar totals
* **raw$unit.grpvar** - If colvar != NULL, a combination of rowvar and colvar 
* If sumunits=TRUE, the raw data for the summed estimation units are also included: (totest, rowest, colest, grpest, respectively). These tables do not included estimate proportions (nhat and nhat.var). See below for variable descriptions.


```{r, results = 'asis', echo=FALSE}

nonratio <- data.frame(Variable = c("phat", "phat.var", "phat.se", "phat.cv", "est", "est.var"), Description = c("Estimated proportion of land", "Variance estimate of estimated proportion of land", "Standard error of estimated proportion of land { sqrt(phat.var) }", "Coefficient of variance of estimated proportion of land { phat.se/phat }", "Estimated percent cover of land { phat*100 }", "Variance of estimated percent cover of land { phat.var*100^2 }"), stringsAsFactors = FALSE)

ratio <- data.frame(Variable = c("phat.n", "phat.var.n", "phat.d", "phat.var.d", "covar", "rhat", "rhat.var", "rhat.se", "rhat.cv", "est", "est.var"), Description = c("Estimated proportion of land, for numerator", "Variance of estimated proportion of land, for numerator", "Estimated proportion of land, for denominator", "Variance of estimated proportion of land, for denominator", "Covariance of estimated proportion of numerator and denominator", "Ratio of estimated proportions (numerator/denominator)", "Variance of ratio of estimated proportions", "Standard error of ratio of estimated proportions { rhat.se/rhat }", "Coefficient of variation of ratio of estimated proportions { sqrt(rhat.var) }", "Estimated percent cover of land { rhat*100 }", "Variance of estimated percent cover of land { rhat.var*100^2 }"), stringsAsFactors = FALSE)

both <- data.frame(Variable = c("nbrpts", "ACRES", "est.se", "est.cv", "pse"), Description=c("Number of points used in estimate", "Total acres for estimation unit (if tabtype='AREA')", "Standard error of estimated percent cover of land { sqrt(est.var) }", "Coefficient of variance of estimated percent cover of land { est.se/est }", "Percent sampling error of the estimated percent cover of land { est.cv*100 }"), stringsAsFactors = FALSE)
  
gainloss <- data.frame(Variable = c("gain.val", "loss.val", "gain.est", "gain.se", "loss.est", "loss.se", "diff.est", "diff.se"), Description = c("Binary class for gain (Not-class to class). For each class, all other values are grouped to Not-class", "Binary class for loss (Not-class to class). For each class, all other values are grouped to Not-class"), "Estimated percent cover where the Class went from Not-class to Class", "Standard error of estimated gain", "Estimated percent cover where the Class went from Class to Not-class", "Standard error of estimated loss", "Difference of estimated gain and estimate loss", "Standard error of the difference of estimated gain and estimated loss")

all <- data.frame(Variable = c("CI99left", "CI99right", "CI95left", "CI95right", "CI68left", "CI68right"), Description = c("Left tail of 99% confidence interval for estimate { est - (2.58*est.se) }", "Right tail of 99% confidence interval for estimate { est + (2.58*est.se) }", 
    "Left tail of 95% confidence interval for estimate { est - (1.96*est.se) }", "Right tail of 95% confidence interval for estimate { est + (1.96*est.se) }", 
    "Left tail of 68% confidence interval for estimate { est - (0.97*est.se) }", "Right tail of 68% confidence interval for estimate { est + (0.97*est.se) }"), 
    stringsAsFactors = FALSE)

library(knitr)
kable(nonratio,
  format = "pandoc",   # default
  caption = "Description of variables in processing tables for nonratio estimates.",
  col.names = names(nonratio),
  row.names = FALSE,
  align = c("l"),       # align = c("c", "c", "c", "r")
  # padding = 2         # inner spacing
)

library(knitr)
kable(ratio,
  format = "pandoc",   # default
  caption = "Description of variables in processing tables for ratio estimates.",
  col.names = names(ratio),
  row.names = FALSE,
  align = c("l"),       # align = c("c", "c", "c", "r")
  # padding = 2         # inner spacing
)

library(knitr)
kable(both,
  format = "pandoc",   # default
  caption = "Description of variables in processing tables for both nonratio and ratio estimates.",
  col.names = names(both),
  row.names = FALSE,
  align = c("l"),       # align = c("c", "c", "c", "r")
  # padding = 2         # inner spacing
)

library(knitr)
kable(all,
  format = "pandoc",   # default
  caption = "Description of variables in processing tables for all estimates.",
  col.names = names(all),
  row.names = FALSE,
  align = c("l"),       # align = c("c", "c", "c", "r")
  # padding = 2         # inner spacing
)

```

<a name="PBfun"></a>

## PB Functions and Examples

The examples following use data from the Image-Based Change Estimation (ICE) project, from two counties, or Estimation Units (ESTN_UNIT) in the state of Utah: Davis (11); Salt Lake (35). 

The ICE project is an image-based inventory across FIA plots designed to supplement the FIA field-based inventory for monitoring land use and land cover change at a more timely interval than the current FIA reporting timeframe. Observations are made at two points in time across all FIA plots and point-level interpretations are made within an acre support region from plot center. Attributes of land use, land cover, change, and agent of change are recorded at each point. The dataset includes plot-level and point-level data for each plot in the sample. The following tutorial uses a subset of ICE data to demonstrate how to generate estimates from the modPB. 

 
## Example data - Utah, Davis and Salt Lake counties (ut1135), Time interval 2011-2014

External data            | Description
:------------------------| :------------------------------------------------------------------
icepnt_utco1135.csv      | ICE point-level data (see ref_icepnt R data frame for variable descriptions)
icepctcover_utco1135.csv | ICE plot-level percentages of land cover 
icepltassgn_utco1135.csv | ICE plot-level data, including estimation unit and strata variables
cover_LUT.csv            | ICE look-up table for land cover classes
chg_ag_LUT.csv           | ICE look-up table for change agent classes
unitarea_utco1135.csv    | Area, in acres, by county estimation unit (ESTN_UNIT)  
strlut_utco1135.csv      | Pixel counts by strata (STRATUMCD) and estimation unit (ESTN_UNIT) 


#### Set up for examples

```
## Set options
options(scipen=6)
options(stringsAsFactors=FALSE)


## Create a folder on CDrive for FIESTA output.
if (!file.exists("C:/FIESTA"))  dir.create("C:/FIESTA")

## Set your working directory to this folder.
setwd("C:/FIESTA")

## Add a subfolder under FIESTA folder named outfolder and create an object called outfolder with this path.
if (!file.exists("outfolder")) dir.create("outfolder")
outfolder <- "outfolder"

## Load FIESTA library. 
library(FIESTA)


## Get external data file names
icepntfn <- system.file("extdata", "PB_data/icepnt_utco1135.csv", package="FIESTA")
icepltfn <- system.file("extdata", "PB_data/icepltassgn_utco1135.csv", package="FIESTA")
icepctcoverfn <- system.file("extdata", "PB_data/icepctcover_utco1135.csv", package="FIESTA")
icechg_agfn <- system.file("extdata", "PB_data/chg_ag_LUT.csv", package="FIESTA")
icecoverfn <- system.file("extdata", "PB_data/cover_LUT.csv", package="FIESTA")
unitareafn <- system.file("extdata", "PB_data/unitarea_utco1135.csv", package="FIESTA")
strlutfn <- system.file("extdata", "PB_data/strlut_utco1135.csv", package="FIESTA")

icepnt <- read.csv(icepntfn)
iceplt <- read.csv(icepltfn)
icepctcover <- read.csv(icepctcoverfn)

## Check variable descriptions for icepnt

## Look at spatial distribution by county (ESTN_UNIT)
icepltsp <- spMakeSpatialPoints(iceplt, xy.uniqueid="plot_id", xvar="LON_PUBLIC", yvar="LAT_PUBLIC", 
              prj="longlat", datum="NAD83")
plot(icepltsp["ESTN_UNIT"])


icecover <- read.csv(icecoverfn)
icechg_ag <- read.csv(icechg_agfn)

head(icepnt)
head(iceplt)
head(icepctcover)
icecover
icechg_ag

unitarea <- read.csv(unitareafn)
strlut <- read.csv(strlutfn)
unitarea
strlut

# Create look-up tables for Time 1 (cover_11) and Time 2 (cover_14) classes
icecover_1 <- icecover
names(icecover_1) <- sub("cover", "cover_1", names(icecover_1))
icecover_2 <- icecover
names(icecover_2) <- sub("cover", "cover_2", names(icecover_2))
icecover_1
icecover_2


```


### Examples
1. [Point-level data - Totals](#pnttot) 
2. [Point-level transition data (T1 Cover - T2 Cover)](#pnttrans)    
3. [Ratio estimates](#pntrat)
4. [Plot-level Data, with percent by domain as separate columns](#pltpct)
5. [Point-level transition data (T1 Cover - T2 Cover) - Post-Stratification](#pntps)
5. [Simple bar plots](#barplt)



#### modPB

```
#######################################################################################
# Usage:
# modPB(pnt = NULL, pltpct = NULL, plotid = "plot_id", pntid = NULL, pltpctvars = NULL,
#   plt = NULL, pltassgn = NULL, puniqueid = "CN", pltassgnid = "CN", ratio = FALSE, 
#   tabtype = "PCT", sumunits = FALSE, strata = FALSE, plt.nonsamp.filter = NULL,
#   unitarea = NULL, unitvar = NULL, unitarea = NULL, areavar = "ACRES", 
#   unitcombine = FALSE, stratalut = NULL, strvar = "STRATUMCD", getwt = TRUE, 
#   getwtvar = "P1POINTCNT", stratcombine = TRUE, landarea = "ALL", landarea.filter = NULL, 
#   pnt.nonsamp.filter = NULL, pnt.filter = NULL, plt.filter = NULL, rowvar = NULL,    
#   colvar = NULL, row.orderby = NULL, col.orderby = NULL, row.add0 = FALSE, col.add0 = FALSE, 
#   rowlut = NULL, collut = NULL, domlut = NULL, domvarlst = NULL, ratioden = "ROWVAR", 
#   allin1 = FALSE, estround = 0, pseround = 3, estnull = 0, psenull = "--", 
#   divideby = NULL, savedata = FALSE, rawdata = FALSE, outfolder = NULL, outfn = NULL, 
#   outfn.pre = NULL, addtitle = TRUE, savetitle = FALSE, title.main = NULL, title.ref = NULL, 
#   title.rowvar = NULL, title.colvar = NULL, title.unitvar = NULL, title.filter = NULL,
#   overwrite = FALSE, PBpopdat = NULL, gui = FALSE)
# 
# Description:
# Generates percent or acre estimates by domain (and estimation unit).   
########################################################################################
help(modPB)

```

<a name="pnttot"></a>

#### Point-level data - Totals

```
## Percent ##
# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
cover1 <- modPB(pnt=icepnt, pltassgn=iceplt, pltassgnid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)")
names(cover1)
cover1$est

# Note: pltassgn is not necessary for this estimate
cover1 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt", 
    rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)")
names(cover1)
cover1$est

# Note: An Uninterpretable class is included in table. To remove, add a nonsamp.filter
cover1 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, rawdata=TRUE, title.rowvar="Land Cover (2011)",
		nonsamp.filter="cover_1 != 999")
names(cover1)
cover1$est


## Area ##
# Area, in acres, of land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
# Add a nonsamp.filter to remove uninterpretable points (e.g., cloud cover)
cover1.area <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)", 
		nonsamp.filter="cover_1 != 999", tabtype="AREA", unitarea=sum(unitarea$ACRES))
cover1.area$est


## Percent ##
# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
# Note: Return raw data
cover1 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)", 
		nonsamp.filter="cover_1 != 999", rawdata=TRUE)
names(cover1)
cover1$est
cover1.raw <- cover1$raw
names(cover1.raw)

cover1.raw$unitvars
cover1.raw$strvar
cover1.raw$rowvar
cover1.raw$colvar
cover1.raw$pntsampcnt
cover1.raw$stratdat
cover1.raw$unit.rowest


## Percent ##
# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
# Note: Save to outfolder
cover1 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)", 
		nonsamp.filter="cover_1 != 999", rawdata=TRUE, savedata=TRUE, outfolder=outfolder)
names(cover1)
cover1$est
cover1.raw <- cover1$raw
names(cover1.raw)


################## Time 2

## Percent ##
# Percent land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
cover2 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_2", rowlut=icecover_2, rawdata=TRUE, title.rowvar="Land Cover (2014)")
names(cover2)
cover2$est


## Compare estimates from Time 2 with estimates from Time 1
cover2$est
cover1$est

## Net change from Time 1 to Time 2
netchg <- data.frame(Estimate1=cover1$est$Estimate, Estimate2=cover2$est$Estimate, 
            NetChange.1to2=cover1$est$Estimate - cover2$est$Estimate)
netchg


#######################################################################################
## By Agent of Change
#######################################################################################

## Percent ##
# Percent land by agent of change in Davis and Salt Lake Counties, UT
chg_ag <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="chg_ag_2", rowlut=icechg_ag, rawdata=TRUE, title.rowvar="Agent of Change",
		returntitle=TRUE)
names(chg_ag)
chg_ag$est
chg_ag$titlelst


## Area ##
# Area, in acres, of land by agent of change in Davis and Salt Lake Counties, UT
chg_ag.area <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="chg_ag_2", rowlut=icechg_ag, rawdata=TRUE, title.rowvar="Agent of Change",
		returntitle=TRUE, tabtype="AREA", unitarea=sum(unitarea$ACRES), title.units="hectares")
names(chg_ag.area)
chg_ag.area$est
chg_ag.area$titlelst


################## Agent of Change - Filters - Percent

## Percent ##
# Percent land with observed change by agent of change in Davis and Salt Lake Counties, UT
# Note: Add a landarea filter to subset dataset to only plots with observed change.
landarea.filter <- "change_1_2 == 1"
chg_ag.plts <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="chg_ag_2", rowlut=icechg_ag, rawdata=TRUE, title.rowvar="Agent of Change",
		landarea="CHANGE", landarea.filter=landarea.filter, returntitle=TRUE)
names(chg_ag.plts)
chg_ag.plts$est
chg_ag.plts$titlelst


## Percent ##
# Percent land changed by agent of change in Davis and Salt Lake Counties, UT
# Note: Add a point filter to include observed change on points
pnt.filter <- "chg_ag_2 > 0"
chg_ag.pnts <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="chg_ag_2", rowlut=icechg_ag, rawdata=TRUE, title.rowvar="Agent of Change",
		pnt.filter=pnt.filter, returntitle=TRUE, title.filter="observed changed")
names(chg_ag.pnts)
chg_ag.pnts$est
chg_ag.pnts$titlelst


# Compare estimates
chg_ag$est
chg_ag.plts$est
chg_ag.pnts$est


################## Agent of Change - Filters - Area

## Area ##
# Area, in acres, of land with observed change by agent of change in Davis and Salt Lake Counties, UT
# Note: Add a landarea filter to subset dataset to only plots with observed change.
landarea.filter <- "change_1_2 == 1"
chg_ag.plts.area <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="chg_ag_2", rowlut=icechg_ag, rawdata=TRUE, title.rowvar="Agent of Change",
		landarea="CHANGE", landarea.filter=landarea.filter, returntitle=TRUE, tabtype="AREA", 
		unitarea=sum(unitarea$ACRES))
names(chg_ag.plts.area)
chg_ag.plts.area$est
chg_ag.plts.area$titlelst


## Area ##
# Area, in acres, of land changed by agent of change in Davis and Salt Lake Counties, UT
# Note: Add a point filter to include observed change on points
pnt.filter <- "chg_ag_2 > 0"
chg_ag.pnts.area <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="chg_ag_2", rowlut=icechg_ag, rawdata=TRUE, title.rowvar="Agent of Change",
		pnt.filter=pnt.filter, returntitle=TRUE, title.filter="observed changed", 
		tabtype="AREA", unitarea=sum(unitarea$ACRES))
names(chg_ag.pnts.area)
chg_ag.pnts.area$est
chg_ag.pnts.area$titlelst


# Compare estimates - Area
chg_ag.area$est
chg_ag.plts.area$est
chg_ag.pnts.area$est


################## Agent of Change - and by Land Cover

## Percent ##
# Percent land changed by agent of change and land cover (2011) in Davis and Salt Lake Counties, UT
chg_ag_cover1 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt", rowvar="chg_ag_2", 
    rowlut=icechg_ag, colvar="cover_1", collut=icecover_1, rawdata=TRUE, 
    title.rowvar="Change agent", title.colvar="Land cover (2011)", returntitle=TRUE)
chg_ag_cover1$est
chg_ag_cover1$pse
chg_ag_cover1$titlelst


## Area ##
# Area, in acres, of land changed by agent of change and land cover (2011) in Davis and Salt Lake Counties, UT
chg_ag_cover1.acres <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt", rowvar="chg_ag_2", 
    rowlut=icechg_ag, colvar="cover_2", collut=icecover_2, rawdata=TRUE, 
    title.rowvar="Change agent", title.colvar="Land cover (2011)", returntitle=TRUE,
    tabtype="AREA", unitarea=sum(unitarea$ACRES))
chg_ag_cover1.acres$est
chg_ag_cover1.acres$pse
chg_ag_cover1.acres$titlelst


## Percent ##
# Percent land changed by agent of change and land cover (2014) in Davis and Salt Lake Counties, UT
chg_ag_cover2 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt", rowvar="chg_ag_2", 
    rowlut=icechg_ag, colvar="cover_2", collut=icecover_2, rawdata=TRUE, 
    title.rowvar="Change agent", title.colvar="Land cover (2014)", returntitle=TRUE)
chg_ag_cover2$est
chg_ag_cover2$pse
chg_ag_cover2$titlelst


#######################################################################################
## By Estimation Unit
#######################################################################################

## Area by Estimation Unit ##
# Area, in acres, of land cover at Time 1 (2011) by County for all land in Davis and Salt Lake Counties, UT
cover1.unit.area <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", 
    pntid="dot_cnt", rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)", 
    nonsamp.filter="cover_1 != 999", tabtype="AREA", unitarea=unitarea, unitvar="ESTN_UNIT", 
    areavar="ACRES")
names(cover1.unit.area)
cover1.unit.area$est
cover1.unit.area$pse


## Area by Estimation Unit ##
# Area, in acres, of land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
# Note: Estimates are generated by ESTN_UNIT and summed to the population.
cover1.unitsum <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)", 
		nonsamp.filter="cover_1 != 999", tabtype="AREA", unitarea=unitarea, 
		unitvar="ESTN_UNIT", areavar="ACRES", sumunits=TRUE)
names(cover1.unitsum)
cover1.unitsum$est


## Area by Estimation Unit ##
# Area, in acres, of land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
# Return raw data
# Note: Estimates are generated by ESTN_UNIT and summed to the population.
cover1.unitsum.area <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, title.rowvar="Land Cover (2011)", 
		nonsamp.filter="cover_1 != 999", tabtype="AREA", unitarea=unitarea, 
		unitvar="ESTN_UNIT", areavar="ACRES", sumunits=TRUE, rawdata=TRUE)
names(cover1.unitsum.area)
cover1.unitsum.area$est

cover1.unitsum.raw <- cover1.unitsum.area$raw
names(cover1.unitsum.raw)
cover1.unitsum.raw$rowest
cover1.unitsum.raw$unit.rowest


```

<a name="pnttrans"></a>

#### Point-level transition data (T1 Cover - T2 Cover)

```
## Percent ##
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
cover12 <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover (2011)", title.colvar="Land Cover (2012)", 
		nonsamp.filter="cover_1 != 999", returntitle=TRUE)
names(cover12)

cover12$est
cover12$pse
cover12.raw <- cover12$raw
names(cover12.raw)
cover12.raw$pntsampcnt
cover12.raw$strlut
head(cover12.raw$pltdom.row)
head(cover12.raw$pltdom.grp)
cover12.raw$unit.rowest
cover12.raw$unit.grpest
cover12$titlelst


## Area ##
# Area, in acres, of land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
cover12.acres <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover (2011)", title.colvar="Land Cover (2012)", 
		nonsamp.filter="cover_1 != 999", tabtype="AREA", unitarea=sum(unitarea$ACRES))
names(cover12.acres)
cover12.acres$est
cover12.acres$pse


################## Concatenate column for transitions

## Percent ##
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# Note: Concatenate (paste) Time 1 and Time 2 columns (merge lookup tables first)
icepnt2 <- merge(icepnt, icecover_1, by="cover_1")
icepnt2 <- merge(icepnt2, icecover_2, by="cover_2")

icepnt2$cover_12_nm <- paste(icepnt2$cover_1_nm, icepnt2$cover_2_nm, sep="-")
cover12nm <- modPB(pnt=icepnt2, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_12_nm", rawdata=TRUE, title.rowvar="Land Cover (2011-2014)",  
		nonsamp.filter="cover_1 != 999", returntitle=TRUE)
names(cover12nm)

cover12nm$est


## Compare estimates
cover12$est
cover12nm$est
cover12$pse


################## Filter transition categories

## Percent ##
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# Filter for only categories of cover_1 < 200
cover12.lt200 <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover (2011)", title.colvar="Land Cover (2012)", 
		nonsamp.filter="cover_1 != 999", pnt.filter="cover_1 < 200", 
		title.filter="Vegetated land", returntitle=TRUE)
names(cover12.lt200)
cover12.lt200$est
cover12.lt200$pse
cover12.lt200$titlelst


################## gain / loss

## Percent ##
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# Return gain/loss estimates for each category in rawdata tables
cover12b <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover (2011)", title.colvar="Land Cover (2014)", 
		nonsamp.filter="cover_1 != 999", gainloss=TRUE)
names(cover12b)

cover12b$est
cover12b$pse
cover12b.raw <- cover12b$raw
names(cover12b.raw)
cover12b.raw$est.gainloss

## Example: the gain and loss of OtherVegetation category...
est.gainloss <- cover12b.raw$est.gainloss
estcat <- "OtherVegetation"

## Gain estimates, with 95% confidence interval
# Note: There was a 2.6% gain of OtherVegetation from 2011 to 2014, +- 2.0%
est.gainloss$gain.CI95left[row.names(est.gainloss) == estcat]
est.gainloss$gain.est[row.names(est.gainloss) == estcat]
est.gainloss$gain.CI95right[row.names(est.gainloss) == estcat]

## Loss estimates, with 95% confidence interval
# Note: There was a 1.8% loss of OtherVegetation from 2011 to 2014, +- 1.3%
est.gainloss$loss.CI95left[row.names(est.gainloss) == estcat]
est.gainloss$loss.est[row.names(est.gainloss) == estcat]
est.gainloss$loss.CI95right[row.names(est.gainloss) == estcat]

## Net change (difference)
# Note: There was a 0.85% net change of OtherVegetation from 2011 to 2014, +- 2.4%
est.gainloss$diff.CI95left[row.names(est.gainloss) == estcat]
est.gainloss$diff.est[row.names(est.gainloss) == estcat]
est.gainloss$diff.CI95right[row.names(est.gainloss) == estcat]


```

<a name="pntrat"></a>

#### Ratio Estimates

```
## Percent ##
# Percent land cover at Time 1 (2011) within land that changed in Davis and Salt Lake Counties, UT 
# Create lookup table with code names
changelut <- data.frame(change_1_2=c(0,1,2), 
                        change_1_2nm=c("No Change", "Change", "Expected Change"))
changelut

chgcover1 <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="change_1_2", rowlut=changelut, colvar="cover_1", 
		collut=icecover_1, nonsamp.filter="cover_1 != 999", rawdata=TRUE, 
		title.rowvar="Change")
chgcover1$est
chgcover1$pse

# Check sum of row estimates. Should sum to 100%.
sum(chgcover1$est[1,-1])
sum(chgcover1$est[2,-1])


## Percent ##
# Percent land cover at Time 1 (2011) within land that changed in Davis and Salt Lake Counties, UT 
# Create lookup table with collapsed code names
# Merge lookup table to icepnt table
changelut <- data.frame(change_1_2=c(0,1,2), change_1_2cd=c(0,1,1), 
                change_1_2nm=c("No change", "Change", "Change"))
icepntdat <- datLUTnm(icepnt, xvar="change_1_2", LUT=changelut)
names(icepntdat)
icepnt2 <- icepntdat$xLUT
head(icepnt2)

chgcover1.grp <- modPB(pnt=icepnt2, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="change_1_2nm", row.orderby="change_1_2cd", colvar="cover_1", 
		collut=icecover_1, nonsamp.filter="cover_1 != 999", rawdata=TRUE, 
		title.rowvar="Change", title.colvar="Land cover (2011)", returntitle=TRUE)
names(chgcover1.grp)
chgcover1.grp$est
chgcover1.grp$pse
chgcover1.grp$titlelst

# Check sum of row estimates. Should sum to 100%.
sum(chgcover1.grp$est[1,-1])
sum(chgcover1.grp$est[2,-1])

# Compare estimates
chgcover1$est
chgcover1.grp$est


## Percent ##
# Percent land cover at Time 1 (2011) within agent of change in Davis and Salt Lake Counties, UT 
chg_ag_cover1.rat <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="chg_ag_2", rowlut=icechg_ag, colvar="cover_1", collut=icecover_1, 
		rawdata=TRUE, nonsamp.filter="cover_1 != 999", title.rowvar="Change agent", 
		title.colvar="Land cover (2011)", returntitle=TRUE)
chg_ag_cover1.rat$est
chg_ag_cover1.rat$pse
chg_ag_cover1.rat$titlelst


# Compare estimates
chg_ag_cover1$est
chg_ag_cover1.rat$est

# Add Total column
chg_ag_cover1.rat$est$Total <- rowSums(chg_ag_cover1.rat$est[,-1], na.rm=TRUE)
chg_ag_cover1.rat$est


## Area ##
# Acres of land cover at Time 1 (2011) within agent of change in Davis and Salt Lake Counties, UT 
chg_ag_cover1.rat.acres <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="chg_ag_2", rowlut=icechg_ag, colvar="cover_1", collut=icecover_1, 
		rawdata=TRUE, nonsamp.filter="cover_1 != 999", title.rowvar="Change agent", 
		title.colvar="Land cover (2011)", returntitle=TRUE, tabtype="AREA",
		unitarea=sum(unitarea$ACRES))
chg_ag_cover1.rat.acres$est
chg_ag_cover1.rat.acres$pse
chg_ag_cover1.rat.acres$titlelst

chg_ag_cover1.rat.acres$est$Total <- rowSums(chg_ag_cover1.rat.acres$est[,-1], na.rm=TRUE)
chg_ag_cover1.rat.acres$est


## Percent ##
# Percent land cover at Time 2 (2014) within land cover at Time 1 in Davis and Salt Lake Counties, UT 
cover1_2.rat <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, nonsamp.filter="cover_1 != 999", title.rowvar="Land cover (2011)", 
		title.colvar="Land cover (2014)", returntitle=TRUE)
cover1_2.rat$est
cover1_2.rat$pse
cover1_2.rat$titlelst


## Area ##
# Acres of land cover at Time 2 (2014) within land cover at Time 1 in Davis and Salt Lake Counties, UT 
cover1_2.acres.rat <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, nonsamp.filter="cover_1 != 999", title.rowvar="Land cover (2011)", 
		title.colvar="Land cover (2014)", returntitle=TRUE, tabtype="AREA",
		unitarea=sum(unitarea$ACRES))
cover1_2.acres.rat$est
cover1_2.acres.rat$pse
cover1_2.acres.rat$titlelst


```

<a name="pltpct"></a>

#### Plot-level Data, with percent by domain as separate columns

```
# Example dataset
head(icepctcover)

# Column names for Time 1 cover (names11) and Time 2 cover (names14)
names11 <- names(icepctcover)[endsWith(names(icepctcover), "11")]
names14 <- names(icepctcover)[endsWith(names(icepctcover), "14")]
names11
names14


## Percent ##
# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
pltpct1 <- modPB(pltpct=icepctcover, pltpctvars=names11)
names(pltpct1)
pltpct1$est


## Percent ##
# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
# Return raw data and titles
pltpct1 <- modPB(pltpct=icepctcover, pltpctvars=names11, rawdata=TRUE, returntitle=TRUE,
    title.rowvar="Land cover (2011)")
names(pltpct1)
pltpct1$est
pltpct1$titlelst
pltpct1.raw <- pltpct1$raw
names(pltpct1.raw)

pltpct1.raw$unit.rowest
pltpct1.raw$stratdat
head(pltpct1.raw$pltdom.row)



## Percent ##
# Percent land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# Return raw data and titles
pltpct2 <- modPB(pltpct=icepctcover, pltpctvars=names11, rawdata=TRUE, returntitle=TRUE,
    title.rowvar="Land cover (2014)")
names(pltpct2)
pltpct2$est
pltpct2$titlelst


## Area ##
# Acres of land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
pltpct1.acres <- modPB(pltpct=icepctcover, pltpctvars=names11, rawdata=TRUE,
    returntitle=TRUE, title.rowvar="Land cover (2011)", tabtype="AREA",
    unitarea=sum(unitarea$ACRES))
names(pltpct1.acres)
pltpct1.acres$est
pltpct1.acres$titlelst
pltpct1.acres$raw$unit.rowest


## Percent - Transition
# Percent land cover change from vegetated to non-vegetated for all land in Davis and Salt Lake Counties, UT
names.trans <- "Veg.NonVeg"
pltpct1.trans <- modPB(pltpct=icepctcover, pltpctvars=names.trans, rawdata=TRUE,
    returntitle=TRUE, title.rowvar="Veg to NonVeg transition")
names(pltpct1.trans)
pltpct1.trans$est
pltpct1.trans$titlelst


```

<a name="pntps"></a>

#### Point-level transition data (T1 Cover - T2 Cover) - Post-Stratification

```
## Percent
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# With post-stratification
cover12ps <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover", strvar="STRATUMCD", stratalut=strlutfn,
		strata=TRUE)
names(cover12ps)

cover12ps$est
cover12ps$pse
raw12ps <- cover12ps$raw
names(raw12ps)
raw12ps$pntsampcnt
raw12ps$strlut
raw12ps$pltdom.row
raw12ps$unit.rowest
raw12ps$unit.grpest


## Compare estimates and percent standard errors without and with post-stratification
#######################################################################################
cover12$est
cover12ps$est

cover12$pse
cover12ps$pse


## Percent
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# With post-stratification
icepnt$cover_12 <- paste(icepnt$cover_1, icepnt$cover_2)
cover12ps <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover", strvar="STRATUMCD", stratalut=strlutfn,
		strata=TRUE)
names(cover12ps)

cover12ps$est
cover12ps$pse


```

<a name="barplt"></a>

#### Simple Bar Plots

```
# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake Counties, UT
names11 <- names(icepctcover)[endsWith(names(icepctcover), "11")]
pltpct1 <- modPB(pltpct=icepctcover, pltpctvars=names11, title.rowvar="Land cover (2011)",
    rawdata=TRUE)
x <- pltpct1$est
x2 <- pltpct1$raw$unit.rowest
datBarplot(x=x, xvar="Land cover (2011)", yvar="Estimate")
datBarplot(x=x2, xvar="variable", yvar="est")

source("C:\\_tsf\\_GitHub\\FIESTA\\R\\datBarplot.R")
datBarplot(x=x2, xvar="variable", yvar="est", ylim=c(0,30), xlabel="Land cover categories",
            ylabel="Percent", errbars=TRUE, sevar="est.se")
            

## Ratio ##
# Percent land cover at Time 2 (2014) within land cover at Time 1 in Davis and Salt Lake Counties, UT 
cover1_2.rat <- modPB(pnt=icepnt, puniqueid="plot_id", pntid="dot_cnt",
		ratio=TRUE, rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, nonsamp.filter="cover_1 != 999", title.rowvar="Land cover (2011)", 
		title.colvar="Land cover (2014)", returntitle=TRUE)
x <- cover1_2.rat$raw$unit.grpest

datBarStacked(x=x, main.attribute="cover_1_nm", sub.attribute="cover_2_nm",
      response="est", xlabel="Land Cover (2011)", legend.title="Land Cover (2014)")
      
      
## Gain / Loss ##
# Percent land cover at Time 1 (2011) by land cover at Time 2 (2014) for all land in Davis and Salt Lake Counties, UT
# Return gain/loss estimates for each category in rawdata tables
cover12b <- modPB(pnt=icepnt, pltassgn=iceplt, puniqueid="plot_id", pntid="dot_cnt",
		rowvar="cover_1", rowlut=icecover_1, colvar="cover_2", collut=icecover_2, 
		rawdata=TRUE, title.rowvar="Land Cover (2011)", title.colvar="Land Cover (2014)", 
		nonsamp.filter="cover_1 != 999", gainloss=TRUE)
names(cover12b)
gainloss <- cover12b.raw$est.gainloss

datPBplotchg(gainloss)


```


## References

Frescino, Tracey S.; Moisen, Gretchen G.; Megown, Kevin A.; Nelson, Val J.; Freeman, Elizabeth A.; Patterson, Paul L.; Finco, Mark; Brewer, Ken; Menlove, James 2009. Nevada Photo-Based Inventory Pilot (NPIP) photo sampling procedures. Gen. Tech. Rep. RMRS-GTR-222. Fort Collins, CO: U.S. Department of Agriculture, Forest Service, Rocky Mountain Research Station. 30 p.

Patterson, Paul L. 2012. Photo-based estimators for the Nevada photo-based inventory. Res. Pap. RMRS-RP-92. Fort Collins, CO: U.S. Department of Agriculture, Forest Service, Rocky Mountain Research Station. 14 p.

Frescino, Tracey S.; Moisen, Gretchen G.; Patterson, Paul L.; Freeman, Elizabeth A.; Patterson, Paul L.; Menlove, James. In Press.. Nevada Photo-Based Inventory Pilot (NPIP) resource estimates. Gen. Tech. Rep. RMRS-GTR-344. Fort Collins, CO: U.S. Department of Agriculture, Forest Service, Rocky Mountain Research Station. 63 p.